<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Random Picker22</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 650px; margin: 40px auto; background-color: #f8f9fa; color: #333; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h2 { color: #2d3436; text-align: center; margin-bottom: 25px; border-bottom: 2px solid #0984e3; padding-bottom: 10px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        label { font-weight: bold; font-size: 0.85rem; color: #636e72; text-transform: uppercase; }
        select { width: 100%; padding: 12px; border: 1px solid #dfe6e9; border-radius: 6px; margin-top: 5px; }
        
        button { width: 100%; padding: 15px; background: #0984e3; color: white; border: none; border-radius: 6px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #074b81; }
        
        .results-container { margin-top: 25px; border-top: 1px solid #eee; padding-top: 20px; }
        .result-item { background: #f1f2f6; padding: 12px 15px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #0984e3; font-weight: 500; }
        .status { text-align: center; font-size: 0.75rem; color: #b2bec3; margin-top: 15px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Random Entry Picker</h2>
    
    <div class="grid">
        <div>
            <label>Category</label>
            <select id="categoryFilter">
                <option value="all">Loading...</option>
            </select>
        </div>
        <div>
            <label>Quantity</label>
            <select id="quantitySelect">
                <option value="1">1 Entry</option>
                <option value="2">2 Entries</option>
                <option value="5">5 Entries</option>
                <option value="10">10 Entries</option>
            </select>
        </div>
    </div>

    <button id="pickBtn">Generate</button>

    <div class="results-container" id="resultsList">
        </div>
    
    <div class="status" id="status">Initializing...</div>
</div>

<script>
    const CSV_URL = 'data.csv'; 
    let dataStore = [];
    
    const filterDropdown = document.getElementById('categoryFilter');
    const quantitySelect = document.getElementById('quantitySelect');
    const pickBtn = document.getElementById('pickBtn');
    const resultsList = document.getElementById('resultsList');
    const statusDiv = document.getElementById('status');

    window.addEventListener('DOMContentLoaded', () => {
        fetch(CSV_URL)
            .then(response => {
                if (!response.ok) throw new Error("File not found");
                return response.text();
            })
            .then(csvText => processCSV(csvText))
            .catch(err => {
                statusDiv.textContent = "Error: Ensure data.csv is in the same folder.";
                statusDiv.style.color = "#d63031";
            });
    });

    function processCSV(csvText) {
        const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== "");
        const categories = new Set();
        dataStore = [];

        // i=1 skips the header row
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            const firstCommaIndex = line.indexOf(',');
            
            if (firstCommaIndex !== -1) {
                const category = line.substring(0, firstCommaIndex).trim();
                const entry = line.substring(firstCommaIndex + 1).trim();
                
                if (category) {
                    categories.add(category);
                    dataStore.push({ category, entry });
                }
            }
        }

        filterDropdown.innerHTML = '<option value="all">-- All Categories --</option>';
        Array.from(categories).sort().forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat;
            opt.textContent = cat;
            filterDropdown.appendChild(opt);
        });

        statusDiv.textContent = `System Ready: ${dataStore.length} items loaded.`;
    }

    pickBtn.addEventListener('click', () => {
        const selectedCat = filterDropdown.value;
        const count = parseInt(quantitySelect.value);
        
        // 1. Filter the data based on the selected category
        let filtered = selectedCat === 'all' 
            ? [...dataStore] // Create a shallow copy
            : dataStore.filter(item => item.category === selectedCat);

        resultsList.innerHTML = ''; // Clear previous results

        if (filtered.length > 0) {
            // 2. Shuffle the filtered array (Fisher-Yates Shuffle)
            // This ensures uniqueness without complex checks
            for (let i = filtered.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [filtered[i], filtered[j]] = [filtered[j], filtered[i]];
            }

            // 3. Determine how many items to show (can't show more than we have)
            const displayCount = Math.min(count, filtered.length);

            // 4. Create the elements for the UI
            for (let i = 0; i < displayCount; i++) {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'result-item';
                itemDiv.textContent = filtered[i].entry;
                resultsList.appendChild(itemDiv);
            }

            // Optional: Warn the user if they asked for 10 but the category only had 4
            if (count > filtered.length) {
                const warning = document.createElement('div');
                warning.style.fontSize = "0.7rem";
                warning.style.color = "#e67e22";
                warning.style.textAlign = "center";
                warning.textContent = `(Only ${filtered.length} unique entries available in this category)`;
                resultsList.appendChild(warning);
            }

        } else {
            resultsList.textContent = "No entries available for this category.";
        }
    });
</script>

</body>
</html>



